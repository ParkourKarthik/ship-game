<!DOCTYPE html>
<html>
<head>
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>

<!-- <script src="jquery-3.1.1.js" ></script> -->

<script>
$(document).ready(function(){
//set attribute for dropping
$('.capture').attr('ondragover','allowDrop(event)')
.attr('ondrop','drop(event)');

randomShipGenerator();
stopMovingShips();
//clearTimeout(timer);


var box = $('#box');
//alert(box.text());
//$('#box').html('Hello World!');
});

//functions
var moveShips = function (){
if($('.shiparea').find('.moving-ship:first').length<1)
{
//self destruct
stopMovingShips();
return;
}
$('.shiparea').find('.moving-ship:first').each(function(index)
{
var currentVal = parseInt($(this).css('margin-left').replace('px',''));
currentVal++;
$(this).css('margin-left', currentVal +'px');
checkAndUpdateScore(this);
});
}

function checkAndUpdateScore(frontship){
//togglePause();
//console.log($(frontship).parent());
var lastShip = $(frontship).parent().find('.moving-ship:last');
var capture = $(frontship).parent().siblings('.capture:last');
if(lastShip.offset().left+45 >= capture.offset().left)
{
if(lastShip.find('.vessel:first').css('background') == capture.css('background'))
updateScore();
else
updateLife();
capture.css('background','');
$(frontship).parent().find('.moving-ship:last').remove();
//alert('Hit');
}
}

var shipSpeed = 10; // millisecond

//to start moving the ships
function startMovingShips()
{
//Set repeated event
if(typeof timer == 'undefined')
timer = setInterval(moveShips,shipSpeed);
}

//Stop the timer
function stopMovingShips()
{
if(typeof timer !== 'undefined')
clearInterval(timer);
timer = undefined;
}


//Degrade life
function updateLife()
{
var curLife = parseInt($('#life').text().trim().replace('Life:',''));
curLife--;
if(curLife==0)
{
$('body').html('<div style="text-align:center"><b>GAME OVER</b></div>')
stopMovingShips();
stopShipGenerator();
}
$('#life').text('Life:'+curLife);
}

//update Score
function updateScore()
{
var curScore = parseInt($('#score').text().trim().replace('Score:',''));
curScore++;
if(curScore>5){
stopMovingShips();
shipSpeed = 5;
startMovingShips();
}
$('#score').text('Score:'+ curScore);
}

var vColors = ["red","green","blue"];

//While dragging of the element starts
function drag(ev){
ev.dataTransfer.setData("color",ev.target.style.background);
}

//PreventDefault blocking in order to grab the dropped element..
function allowDrop(ev){
ev.preventDefault();
}

//While dropping
function drop(ev){
ev.preventDefault();
var color = ev.dataTransfer.getData("color");
ev.target.style.background=color;
}

function stopShipGenerator()
{
clearTimeout(shipGenerator);
}


//Toggle between pause and play..
function togglePause(){
if($('#pause').text().trim()=='PAUSE'){
stopMovingShips();
stopShipGenerator();
$('#colors div').attr('draggable','false');
$('#colors div').attr('ondragstart','return false');
$('#pause').text('PLAY');
}
else{
startMovingShips();
randomShipGenerator();
$('.colors div').attr('draggable','true');
$('#colors div').attr('ondragstart','drag(event)');
$('#pause').text('PAUSE');
}
}

// Generate and send ships to the tracks
function generateShip(row){
if(!row)
{
return;
}
var shipcolor = vColors[Math.floor(vColors.length * Math.random())];
var ship = '<div class="moving-ship" style="margin-left:0px;display:inline-block;">'+
              '<div class="vessel" style="    height: 15px;'+
    'width: 9px;'+
    'background: '+ shipcolor +';'+
    'position: relative;'+
    'margin-left:30px;"> </div>'+
	'<div class="vessel" style="    border-top: 20px solid '+ shipcolor +';'+
    'border-left: 15px solid transparent;'+
    'border-right: 15px solid transparent;'+
    'height: 0;'+
    'width: 16px;">'+
              '</div>'+
'</div>';
$('.shiparea:eq('+(row-1)+')').find('.moving-ship:first').each(function(){
$(this).css('margin-left',parseInt($(this).css('margin-left'))-46);
}); ;
$('.shiparea:eq('+(row-1)+')').prepend(ship);
randomShipGenerator();
startMovingShips();
var firstship = $('.shiparea').find('.moving-ship:first');
checkAndUpdateScore(firstship);
}

//Generate ship at random intervals..
function randomShipGenerator(){
var invokeAt = randomIntFromInterval(2000,4000)
var TrackNo = randomIntFromInterval(1,2);

shipGenerator = setTimeout(generateShip,invokeAt,TrackNo);
}

//Util for generating random numbers
function randomIntFromInterval(min,max)
{
    return Math.floor(Math.random()*(max-min+1)+min);
}



</script>

</head>

<body style="background:#00FFFF">
<div style="text-align:center">Drag and Drop the ship's respective color in the container before the ship hits the container.</div>
<div id="box" class="track" style="height:100px">
<div class="shiparea" style="margin:50px 0 0 300px;display:inline-block">
<!-- <div class="moving-ship" style="margin-left:80px;display:inline-block;">
              <div class="vessel" style="    height: 15px;
    width: 9px;
    background: red;
    position: relative;
    margin-left:30px;"> </div>
	<div class="vessel" style="    border-top: 20px solid red;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    height: 0;
    width: 16px;">
              </div>
</div>
 --></div>
<div id="capture" class="capture"  style="margin-right:400px;margin-top:40px; float:right;border:1px solid black;height:50px;width:30px;position:relative;display:inline-block">
</div>
</div>
<div id="box1" class="track" style="height:100px">
<div class="shiparea" style="margin:50px 0 0 300px;display:inline-block">
<!-- <div class="moving-ship" style="margin-left:80px;display:inline-block;">
              <div class="vessel" style="    height: 15px;
    width: 9px;
    background: red;
    position: relative;
    margin-left:30px;"> </div>
	<div class="vessel" style="    border-top: 20px solid red;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    height: 0;
    width: 16px;">
              </div>
</div>
 --></div>
<div id="capture" class="capture"  style="margin-right:400px;margin-top:40px; float:right;border:1px solid black;height:50px;width:30px;position:relative;display:inline-block">
</div>
</div>
<div id="container" style="width:100%;margin-top:20px;">
<div id="colors" style="margin-right:400px;float:right;position:relative;cursor:pointer">
<div id="red" style="height:50px;width:30px;position:relative;background:red;display:inline-block" draggable="true" ondragstart="drag(event)">
</div>
<div id="green" style="height:50px;width:30px;position:relative;background:green;display:inline-block" draggable="true" ondragstart="drag(event)">
</div>
<div id="blue" style="height:50px;width:30px;position:relative;background:blue;display:inline-block;" draggable="true" ondragstart="drag(event)">
</div>
</div>
<div id="score" style="font-weight:bold;font-size:2em;" >
Score:0
</div>
<div id="life" style="font-weight:bold;font-size:2em;margin-top:20px;">
Life:3
</div>
<button id="pause" onclick="togglePause()" style="margin-top:50px">
PAUSE
</button>

</body>


</html>